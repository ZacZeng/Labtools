% 1. This is for catenating *.mat files converted from alpha-omega *.mpx files (limited by 1G) together
% and tranform them into binary files
% 2. Do sipke sorting based on the binary files using kilosort2
% LBY 20191223

function h1 = SpikeSortingAO_k_GUI_export()

clear all;clc;
%close all;

global ori_data monkeys;
ori_data = [];
monkeys = {'Polo';'Qiaoqiao'}; % Add or change Monkeys here

appdata = [];
appdata.GUIDEOptions = struct(...
    'active_h', 403.003784179688, ...
    'taginfo', struct(...
    'figure', 2, ...
    'text', 9, ...
    'edit', 5, ...
    'pushbutton', 9, ...
    'popupmenu', 2), ...
    'override', 0, ...
    'release', 13, ...
    'resize', 'none', ...
    'accessibility', 'callback', ...
    'mfile', 0, ...
    'callbacks', 1, ...
    'singleton', 1, ...
    'syscolorfig', 1, ...
    'blocking', 0, ...
    'lastFilename', 'Z:\Labtools\Tools\SpikeSortingAO_k_GUI.fig');
appdata.lastValidTag = 'figure1';
appdata.GUIDELayoutEditor = [];
appdata.initTags = struct(...
    'handle', [], ...
    'tag', 'figure1');

h1 = figure(...
    'Units','characters',...
    'Color',[0.941176470588235 0.941176470588235 0.941176470588235],...
    'Colormap',[0 0 0.5625;0 0 0.625;0 0 0.6875;0 0 0.75;0 0 0.8125;0 0 0.875;0 0 0.9375;0 0 1;0 0.0625 1;0 0.125 1;0 0.1875 1;0 0.25 1;0 0.3125 1;0 0.375 1;0 0.4375 1;0 0.5 1;0 0.5625 1;0 0.625 1;0 0.6875 1;0 0.75 1;0 0.8125 1;0 0.875 1;0 0.9375 1;0 1 1;0.0625 1 1;0.125 1 0.9375;0.1875 1 0.875;0.25 1 0.8125;0.3125 1 0.75;0.375 1 0.6875;0.4375 1 0.625;0.5 1 0.5625;0.5625 1 0.5;0.625 1 0.4375;0.6875 1 0.375;0.75 1 0.3125;0.8125 1 0.25;0.875 1 0.1875;0.9375 1 0.125;1 1 0.0625;1 1 0;1 0.9375 0;1 0.875 0;1 0.8125 0;1 0.75 0;1 0.6875 0;1 0.625 0;1 0.5625 0;1 0.5 0;1 0.4375 0;1 0.375 0;1 0.3125 0;1 0.25 0;1 0.1875 0;1 0.125 0;1 0.0625 0;1 0 0;0.9375 0 0;0.875 0 0;0.8125 0 0;0.75 0 0;0.6875 0 0;0.625 0 0;0.5625 0 0],...
    'IntegerHandle','off',...
    'InvertHardcopy',get(0,'defaultfigureInvertHardcopy'),...
    'MenuBar','none',...
    'Name','---- Spike sorting (kilosort) GUI ----',...
    'NumberTitle','off',...
    'PaperPosition',get(0,'defaultfigurePaperPosition'),...
    'Position',[20 30 98.0 32.15384615384615],...
    'Resize','off',...
    'HandleVisibility','callback',...
    'UserData',[],...
    'Tag','figure1');
%     'Position',[-150 47.84615384615385 98.0 32.15384615384615],...

h2 = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'FontSize',12,...
    'FontWeight','bold',...
    'HorizontalAlignment','left',...
    'Position',[6.5 27.84615384615398 17.8 2.38461538461538],...
    'String','Monkey: ',...
    'Style','text',...
    'Tag','text1');

h3 = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'FontSize',12,...
    'FontWeight','bold',...
    'HorizontalAlignment','left',...
    'Position',[6.5 24.76923076923086 17.8 2.38461538461538],...
    'String','File name:',...
    'Style','text',...
    'Tag','text2');

hMonkey = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'BackgroundColor',[1 1 1],...
    'FontSize',12,...
    'Position',[23.4 27.846153846153868 22 2.76923076923077],...
    'String',monkeys,...
    'Style','popupmenu',...
    'Value',1);

h22 = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'FontSize',12,...
    'FontWeight','bold',...
    'HorizontalAlignment','left',...
    'Position',[6.5 21.923076923076955 9.2 2.38461538461538],...
    'String','#Ch:',...
    'Style','text',...
    'Tag','text1');

hChNo = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'BackgroundColor',[1 1 1],...
    'FontSize',12,...
    'HorizontalAlignment','left',...
    'Position',[14.8 22.38461538461536 6.8 2.23076923076923],...
    'String','16',...
    'Style','edit',...
    'Tag','channel number');

h_fileName = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'BackgroundColor',[1 1 1],...
    'FontSize',12,...
    'HorizontalAlignment','left',...
    'Position',[23.4 25.230769230769265 22 2.23076923076923],...
    'String','m?c?r?',...
    'Style','edit',...
    'Tag','Filename');

% Good stuffs for change filename. Copy from HH20130831
fileNametemp = textread('Z:\Labtools\Tools\MergeAO_k_LastFileName.txt','%s');
fileName = fileNametemp{:};
set(h_fileName,'string',fileName);


h5 = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'Callback',{@ChangeFileName,h_fileName},...
    'Position',[23.4 22.692307692307764 5 1.76923076923077],...
    'String','+c',...
    'FontWeight','bold',...
    'Tag','pushbutton1');


h6 = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'Callback',{@ChangeFileName,h_fileName},...
    'Position',[29 22.692307692307764 5 1.76923076923077],...
    'String','-c',...
    'FontWeight','bold',...
    'Tag','pushbutton2');

h7 = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'Callback',{@ChangeFileName,h_fileName},...
    'Position',[36.8000000000001 22.692307692307764 5 1.76923076923077],...
    'String','+r',...
    'FontWeight','bold',...
    'Tag','pushbutton3');

h8 = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'Callback',{@ChangeFileName,h_fileName},...
    'Position',[42.4 22.692307692307764 5 1.76923076923077],...
    'String','-r',...
    'FontWeight','bold',...
    'Tag','pushbutton4');

h11 = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'FontSize',19,...
    'FontWeight','bold',...
    'ForegroundColor',[0.313725490196078 0.313725490196078 0.313725490196078],...
    'HorizontalAlignment','right',...
    'Position',[46 25.846153846153868 45 5.61538461538462],...
    'String',{'SPIKE SORTING'},...
    'Style','text',...
    'Tag','text3');

h_pathName = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'BackgroundColor',[1 1 1],...
    'FontSize',11,...
    'HorizontalAlignment','left',...
    'Position',[23.4 19.26923076923078 56.6 2.23076923076923],...
    'String','Z:\Data\MOOG\Polo\raw\LA\',...
    'Style','edit',...
    'Tag','Pathname');

hSavePath = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'BackgroundColor',[1 1 1],...
    'FontSize',11,...
    'HorizontalAlignment','left',...
    'Position',[23.4 16.384615384615426 56.6 2.23076923076923],...
    'String','Z:\Data\MOOG\Polo\raw\LA\',...
    'Style','edit',...
    'Tag','SavePath');

hRefreshDataPath = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'FontSize',11,...
    'callback',{@ChangeDataPath,hMonkey,h_fileName, h_pathName,hSavePath},...
    'HorizontalAlignment','left',...
    'Position',[6.5 19.26923076923078 15 2.38461538461538],...
    'String','Data path:',...
    'Style','pushbutton');

hRefreshSavePath = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'FontSize',11,...
    'callback',{@ChangeSavePath,h_pathName,hSavePath},...
    'HorizontalAlignment','left',...
    'Position',[6.5 16.269230769230788 15 2.38461538461538],...
    'String','Save path:',...
    'Style','pushbutton');

hBrowseOpen = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'Callback',{@BrowseOpen,monkeys,hMonkey,h_fileName,h_pathName,hSavePath},...
    'Position',[82.2 19.346153846153857 10.6 2.23076923076923],...
    'String','Browse',...
    'Tag','BrowseOpen');

hBrowseSave = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'Callback',{@FileSave,hSavePath},...
    'Position',[82.2 16.44615384615386 10.6 2.23076923076923],...
    'String','Browse',...
    'Tag','BrowseSave');

hLoadData = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'Callback','mergeAO_kilosort(''load data'')',...
    'FontSize',12,...
    'FontWeight','bold',...
    'ForegroundColor',[0 0.2667 0.6863],...
    'Position',[23 8.846153846153852 20 3.23076923076923],...
    'String','Load data',...
    'Tag','LoadData');

hInfo = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'Callback','mergeAO_kilosort(''show info'')',...
    'FontSize',12,...
    'FontWeight','bold',...
    'ForegroundColor',[0 0.6902 0.3137],...
    'Position',[45 8.846153846153852 12 3.23076923076923],...
    'String','Info',...
    'Tag','info');

hInfoShowPanel = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'BackgroundColor',[1 1 1],...
    'ForegroundColor',[0 0.6902 0.3137],...
    'Position',[57 22.84615384615385 35 5.30769230769231],...
    'String','Information of the data',...
    'Style','listbox',...
    'FontWeight','bold',...
    'Value',1,...
    'Tag','InfoShowPanel');

hMergeAO = uicontrol(...
    'Parent',h1,...
    'Units','characters',...
    'Callback','mergeAO_kilosort(''merge files'')',...
    'FontSize',16,...
    'FontWeight','bold',...
    'ForeGroundColor',[0.8 0 0],...
    'Position',[59 8.846153846153852 12 3.23076923076923],...
    'String','GO!',...
    'Tag','pushbutton6');

hToMat = uicontrol(...
'Parent',h1,...
'Units','characters',...
'Callback',@OpenMapfile,...
'FontSize',12,...
'FontWeight','bold',...
'ForegroundColor',[0.247058823529412 0.247058823529412 0.247058823529412],...
'Position',[6 8.846153846153852 15 3.23076923076923],...
'String','To .mat');

hRefresh = uicontrol(...
'Parent',h1,...
'Units','characters',...
'Callback',{@Refresh,h_fileName, h_pathName},...
'FontSize',6,...
'Position',[46.4 25.230769230769265 8 2.23076923076923],...
'String','Refresh',...
'Tag','pushbutton1');

h26 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontSize',12,...
'FontWeight','bold',...
'HorizontalAlignment','left',...
'Position',[6.8 12.230769230769234 33.2 2.38461538461538],...
'String','Merge AO files : ',...
'Style','text');

h27 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontSize',12,...
'FontWeight','bold',...
'HorizontalAlignment','left',...
'Position',[6.8 5 53.4 2.38461538461538],...
'String','Spike sorting ( kilosort ) : ',...
'Style','text');

h31 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'Callback',@OpenKiloSort,...
'FontSize',12,...
'FontWeight','bold',...
'ForegroundColor',[0.247058823529412 0.247058823529412 0.247058823529412],...
'Position',[6 1.15384615384615 29.4 3.23076923076923],...
'String','Open kilosort');

h30 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'Callback',@editChNo,...
'FontSize',12,...
'FontWeight','bold',...
'ForegroundColor',[0.247058823529412 0.247058823529412 0.247058823529412],...
'Position',[70 1.15384615384615 24 3.23076923076923],...
'String','Edit chOrder',...
'Tag','SpikeSorting');

hDM = uicontrol(...
'Parent',h1,...
'Units','characters',...
'Callback','mergeAO_kilosort(''load DM'')',...
'FontSize',12,...
'FontWeight','bold',...
'ForegroundColor',[0.247058823529412 0.247058823529412 0.247058823529412],...
'Position',[75 8.846153846153852 20 3.23076923076923],...
'String','Load DM',...
'Tag','SpikeSorting');

saveas(h1,'Z:\Labtools\Tools\SpikeSortingAO_k_GUI.fig');

%%%%%%%%%%%%% Functions

function ChangeFileName(src, ~, h_fileName)
fileName = get(h_fileName,'String');
c_pos = find(fileName == 'c', 1);
r_pos = find(fileName == 'r',1);
dot_pos = find(fileName=='.',1);

if ~isempty(dot_pos)
    fileName = fileName(1:dot_pos-1);
end

if ~isempty(c_pos) && ~isempty(r_pos)
    switch get(src,'string')
        case '+c'
            value = str2double(fileName(c_pos+1:r_pos-1)) + 1;
            fileName = [fileName(1:c_pos) num2str(value) 'r1'];
        case '-c'
            value = str2double(fileName(c_pos+1:r_pos-1));
            value = value - 1 * (value~=1);
            fileName = [fileName(1:c_pos) num2str(value) 'r1'];
        case '+r'
            value = str2double(fileName(r_pos+1:end)) + 1;
            fileName = [fileName(1:r_pos) num2str(value)];
        case '-r'
            value = str2double(fileName(r_pos+1:end));
            value = value - 1 * (value~=1);
            fileName = [fileName(1:r_pos) num2str(value)];
    end
    
    if ~isempty(dot_pos) fileName = [fileName '.htb']; end
    set(h_fileName,'String',fileName);
    
end

function BrowseOpen(src,~,monkeys,hMonkey,h_fileName,h_pathName,hSavePath)

filename = get(h_fileName,'string');
pathname = ['Z:\Data\MOOG\',monkeys{get(hMonkey,'value')},'\raw\LA\',filename,'\'];
% PATH = get(h_pathName, 'String');
fname = uigetdir(pathname,'Select the directory');
if (fname ~= 0)
    set(h_pathName, 'String', fname);
    set(hSavePath, 'String', fname); % Set save path the same as the file open path
end

function FileSave(src,~,hSavePath)

PATH = get(hSavePath, 'String');
fname = uigetdir(PATH,'Select the directory you want to save the files');
if (fname ~= 0)
    set(hSavePath, 'String', fname); % Set the new save path
end

function ChangeDataPath(src,~,hMonkey,h_fileName, h_pathName,hSavePath)
global monkeys;
fileNametemp = get(h_fileName,'string');
set(h_pathName,'string',['Z:\Data\MOOG\',monkeys{get(hMonkey,'value')},'\raw\LA\',fileNametemp]);
filePath = get(h_pathName,'string');
set(hSavePath,'string',filePath);

function ChangeSavePath(src,~,h_pathName,hSavePath)

filePath = get(h_pathName,'string');
set(hSavePath,'string',filePath);

function Refresh(src,~,h_fileName, h_pathName)

filePathName = get(h_pathName,'string');
fileNameTemp = filePathName(end-8:end);
set(h_fileName,'string',fileNameTemp);

function OpenMapfile(src,~)

winopen('E:\Apps\Converter\Mapfile.exe')

function editChNo(src,~)

open mergeAO_kilosort;




% --- Executes on button press in pushbutton1.
function pushbutton1_Callback(hObject, eventdata, handles)
% hObject    handle to pushbutton1 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --- Executes on button press in pushbutton2.
function pushbutton2_Callback(hObject, eventdata, handles)
% hObject    handle to pushbutton2 (see GCBO)
% eventdata  reserved - to be defined in a future version of MATLAB
% handles    structure with handles and user data (see GUIDATA)


% --- Creates and returns a handle to the GUI figure. 
function h1 = SpikeSortingAO_k_GUI_export_LayoutFcn(policy)
% policy - create a new figure or use a singleton. 'new' or 'reuse'.

persistent hsingleton;
if strcmpi(policy, 'reuse') & ishandle(hsingleton)
    h1 = hsingleton;
    return;
end
load SpikeSortingAO_k_GUI_export.mat


appdata = [];
appdata.GUIDEOptions = struct(...
    'active_h', [], ...
    'taginfo', struct(...
    'pushbutton', 3), ...
    'override', 0, ...
    'release', 12, ...
    'resize', 'none', ...
    'accessibility', 'callback', ...
    'mfile', 1, ...
    'callbacks', 1, ...
    'singleton', 1, ...
    'syscolorfig', 0, ...
    'blocking', 0, ...
    'lastFilename', 'Z:\Labtools\Tools\SpikeSortingAO_k_GUI.fig', ...
    'lastSavedFile', 'Z:\Labtools\Tools\SpikeSortingAO_k_GUI_export.m');
appdata.lastValidTag = 'figure1';
appdata.GUIDELayoutEditor = [];
appdata.initTags = struct(...
    'handle', [], ...
    'tag', 'figure1');

h1 = figure(...
'Units','characters',...
'Position',[20 30 98 32.1538461538462],...
'Visible',get(0,'defaultfigureVisible'),...
'Color',[0.941176470588235 0.941176470588235 0.941176470588235],...
'IntegerHandle','off',...
'Colormap',[0 0 0.5625;0 0 0.625;0 0 0.6875;0 0 0.75;0 0 0.8125;0 0 0.875;0 0 0.9375;0 0 1;0 0.0625 1;0 0.125 1;0 0.1875 1;0 0.25 1;0 0.3125 1;0 0.375 1;0 0.4375 1;0 0.5 1;0 0.5625 1;0 0.625 1;0 0.6875 1;0 0.75 1;0 0.8125 1;0 0.875 1;0 0.9375 1;0 1 1;0.0625 1 1;0.125 1 0.9375;0.1875 1 0.875;0.25 1 0.8125;0.3125 1 0.75;0.375 1 0.6875;0.4375 1 0.625;0.5 1 0.5625;0.5625 1 0.5;0.625 1 0.4375;0.6875 1 0.375;0.75 1 0.3125;0.8125 1 0.25;0.875 1 0.1875;0.9375 1 0.125;1 1 0.0625;1 1 0;1 0.9375 0;1 0.875 0;1 0.8125 0;1 0.75 0;1 0.6875 0;1 0.625 0;1 0.5625 0;1 0.5 0;1 0.4375 0;1 0.375 0;1 0.3125 0;1 0.25 0;1 0.1875 0;1 0.125 0;1 0.0625 0;1 0 0;0.9375 0 0;0.875 0 0;0.8125 0 0;0.75 0 0;0.6875 0 0;0.625 0 0;0.5625 0 0],...
'MenuBar','none',...
'Name','---- Spike sorting (kilosort) GUI ----',...
'NumberTitle','off',...
'HandleVisibility','callback',...
'Tag','figure1',...
'Resize','off',...
'PaperPosition',get(0,'defaultfigurePaperPosition'),...
'InvertHardcopy',get(0,'defaultfigureInvertHardcopy'),...
'ScreenPixelsPerInchMode','manual',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'text1';

h2 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'HorizontalAlignment','left',...
'String','Monkey: ',...
'Style','text',...
'Position',[6.5 27.846153846154 17.8 2.38461538461538],...
'Children',[],...
'Tag','text1',...
'FontSize',12,...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'text2';

h3 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'HorizontalAlignment','left',...
'String','File name:',...
'Style','text',...
'Position',[6.5 24.7692307692309 17.8 2.38461538461538],...
'Children',[],...
'Tag','text2',...
'FontSize',12,...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = blanks(0);

h4 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String',{  'Polo'; 'Qiaoqiao' },...
'Style','popupmenu',...
'Value',1,...
'Position',[23.4 27.8461538461539 22 2.76923076923077],...
'BackgroundColor',[1 1 1],...
'Children',[],...
'FontSize',12,...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'text1';

h5 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'HorizontalAlignment','left',...
'String','#Ch:',...
'Style','text',...
'Position',[6.5 21.923076923077 9.2 2.38461538461538],...
'Children',[],...
'Tag','text1',...
'FontSize',12,...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = blanks(0);

h6 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'HorizontalAlignment','left',...
'String','16',...
'Style','edit',...
'Position',[14.8 22.3846153846154 6.8 2.23076923076923],...
'BackgroundColor',[1 1 1],...
'Children',[],...
'Tag','channel number',...
'FontSize',12,...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'Filename';

h7 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'HorizontalAlignment','left',...
'String','m6c2005r2',...
'Style','edit',...
'Position',[23.4 25.2307692307693 22 2.23076923076923],...
'BackgroundColor',[1 1 1],...
'Children',[],...
'Tag','Filename',...
'FontSize',12,...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton1';

h8 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String','+c',...
'Position',[23.4 22.6923076923078 5 1.76923076923077],...
'Callback',mat{1},...
'Children',[],...
'Tag','pushbutton1',...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton2';

h9 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String','-c',...
'Position',[29 22.6923076923078 5 1.76923076923077],...
'Callback',mat{2},...
'Children',[],...
'Tag','pushbutton2',...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton3';

h10 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String','+r',...
'Position',[36.8000000000001 22.6923076923078 5 1.76923076923077],...
'Callback',mat{3},...
'Children',[],...
'Tag','pushbutton3',...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton4';

h11 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String','-r',...
'Position',[42.4 22.6923076923078 5 1.76923076923077],...
'Callback',mat{4},...
'Children',[],...
'Tag','pushbutton4',...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'text3';

h12 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'HorizontalAlignment','right',...
'String',{  'SPIKE SORTING' },...
'Style','text',...
'Position',[46 25.8461538461539 45 5.61538461538462],...
'Children',[],...
'ForegroundColor',[0.313725490196078 0.313725490196078 0.313725490196078],...
'Tag','text3',...
'FontSize',19,...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'Pathname';

h13 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'HorizontalAlignment','left',...
'String','Z:\Data\MOOG\Polo\raw\LA\',...
'Style','edit',...
'Position',[23.4 19.2692307692308 56.6 2.23076923076923],...
'BackgroundColor',[1 1 1],...
'Children',[],...
'Tag','Pathname',...
'FontSize',11,...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'SavePath';

h14 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'HorizontalAlignment','left',...
'String','Z:\Data\MOOG\Polo\raw\LA\',...
'Style','edit',...
'Position',[23.4 16.3846153846154 56.6 2.23076923076923],...
'BackgroundColor',[1 1 1],...
'Children',[],...
'Tag','SavePath',...
'FontSize',11,...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = blanks(0);

h15 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'HorizontalAlignment','left',...
'String','Data path:',...
'Style',get(0,'defaultuicontrolStyle'),...
'Position',[6.5 19.2692307692308 15 2.38461538461538],...
'Callback',mat{5},...
'Children',[],...
'FontSize',11,...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = blanks(0);

h16 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'HorizontalAlignment','left',...
'String','Save path:',...
'Style',get(0,'defaultuicontrolStyle'),...
'Position',[6.5 16.2692307692308 15 2.38461538461538],...
'Callback',mat{6},...
'Children',[],...
'FontSize',11,...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'BrowseOpen';

h17 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String','Browse',...
'Position',[82.2 19.3461538461539 10.6 2.23076923076923],...
'Callback',mat{7},...
'Children',[],...
'Tag','BrowseOpen',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'BrowseSave';

h18 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String','Browse',...
'Position',[82.2 16.4461538461539 10.6 2.23076923076923],...
'Callback',mat{8},...
'Children',[],...
'Tag','BrowseSave',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'LoadData';

h19 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String','Load data',...
'Position',[23 8.84615384615385 20 3.23076923076923],...
'Callback','mergeAO_kilosort(''load data'')',...
'Children',[],...
'ForegroundColor',[0 0.2667 0.6863],...
'Tag','LoadData',...
'FontSize',12,...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'info';

h20 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String','Info',...
'Position',[45 8.84615384615385 12 3.23076923076923],...
'Callback','mergeAO_kilosort(''show info'')',...
'Children',[],...
'ForegroundColor',[0 0.6902 0.3137],...
'Tag','info',...
'FontSize',12,...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'InfoShowPanel';

h21 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String','Information of the data',...
'Style','listbox',...
'Value',1,...
'Position',[57 22.8461538461539 35 5.30769230769231],...
'BackgroundColor',[1 1 1],...
'Children',[],...
'ForegroundColor',[0 0.6902 0.3137],...
'Tag','InfoShowPanel',...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton6';

h22 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String','GO!',...
'Position',[59 8.84615384615385 12 3.23076923076923],...
'Callback','mergeAO_kilosort(''merge files'')',...
'Children',[],...
'ForegroundColor',[0.8 0 0],...
'Tag','pushbutton6',...
'FontSize',16,...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = blanks(0);

h23 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String','To .mat',...
'Position',[6 8.84615384615385 15 3.23076923076923],...
'Callback',mat{9},...
'Children',[],...
'ForegroundColor',[0.247058823529412 0.247058823529412 0.247058823529412],...
'FontSize',12,...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton1';

h24 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String','Refresh',...
'Position',[46.4 25.2307692307693 8 2.23076923076923],...
'Callback',mat{10},...
'Children',[],...
'Tag','pushbutton1',...
'FontSize',6,...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = blanks(0);

h25 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'HorizontalAlignment','left',...
'String','Merge AO files : ',...
'Style','text',...
'Position',[6.8 12.2307692307692 33.2 2.38461538461538],...
'Children',[],...
'FontSize',12,...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = blanks(0);

h26 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'HorizontalAlignment','left',...
'String','Spike sorting ( kilosort ) : ',...
'Style','text',...
'Position',[6.8 5 53.4 2.38461538461538],...
'Children',[],...
'FontSize',12,...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = blanks(0);

h27 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String','Open kilosort',...
'Position',[6 1.15384615384615 29.4 3.23076923076923],...
'Callback',mat{11},...
'Children',[],...
'ForegroundColor',[0.247058823529412 0.247058823529412 0.247058823529412],...
'FontSize',12,...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'SpikeSorting';

h28 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String','ChOrder',...
'Position',[37.2 1.14285714285714 16 3.21428571428571],...
'Callback',mat{12},...
'Children',[],...
'ForegroundColor',[0.247058823529412 0.247058823529412 0.247058823529412],...
'Tag','SpikeSorting',...
'FontSize',12,...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'SpikeSorting';

h29 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String','DM',...
'Position',[72.6 8.85714285714286 8.59999999999999 3.21428571428571],...
'Callback','mergeAO_kilosort(''load DM'')',...
'Children',[],...
'ForegroundColor',[0.247058823529412 0.247058823529412 0.247058823529412],...
'Tag','SpikeSorting',...
'FontSize',12,...
'FontWeight','bold',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton1';

h30 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String','Combine',...
'Style',get(0,'defaultuicontrolStyle'),...
'Position',[85 9 11 2.92857142857143],...
'Callback',@(hObject,eventdata)SpikeSortingAO_k_GUI_export('pushbutton1_Callback',hObject,eventdata,guidata(hObject)),...
'Children',[],...
'Tag','pushbutton1',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );

appdata = [];
appdata.lastValidTag = 'pushbutton2';

h31 = uicontrol(...
'Parent',h1,...
'Units','characters',...
'FontUnits',get(0,'defaultuicontrolFontUnits'),...
'String','Split',...
'Style',get(0,'defaultuicontrolStyle'),...
'Position',[61.6 1.64285714285714 13.8 2.57142857142857],...
'Callback',@(hObject,eventdata)SpikeSortingAO_k_GUI_export('pushbutton2_Callback',hObject,eventdata,guidata(hObject)),...
'Children',[],...
'Tag','pushbutton2',...
'CreateFcn', {@local_CreateFcn, blanks(0), appdata} );


hsingleton = h1;


% --- Set application data first then calling the CreateFcn. 
function local_CreateFcn(hObject, eventdata, createfcn, appdata)

if ~isempty(appdata)
   names = fieldnames(appdata);
   for i=1:length(names)
       name = char(names(i));
       setappdata(hObject, name, getfield(appdata,name));
   end
end

if ~isempty(createfcn)
   if isa(createfcn,'function_handle')
       createfcn(hObject, eventdata);
   else
       eval(createfcn);
   end
end
